<!DOCTYPE html>
<html ng-app='devstudy'>
<head>
<!--
⣀⡀ ⢀⣀ ⢀⣀ ⡀⢀ ⢀⡀ ⣰⡀
⠇⠸ ⠣⠼ ⠣⠤ ⣑⡺ ⠣⠜ ⠘⠤

Copyright © 2013- nacyot<Daewkon Kim> All Rights Reserved.
-->
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='images/favicon.ico' rel='shortcut icon' type='image/x-icon'>
<link href='http://blog.nacyot.com/articles/2013-10-02-ruby-test-automation-with-rspec-and-guard/' rel='canonical'>
<link href='http://blog.nacyot.com/feed.xml' rel='alternative' type='application/rss+xml'>
<link href='/articles/2013-10-30-angularjs-style-guide/' rel='next' title='AngularJs 스타일 가이드 번역'>
<meta content='루비 테스트로는 minitest와 Rspec이 많이 사용됩니다. 저는 대부분 Rspec을 사용합니다만, 어느 쪽이건 이러한 테스트를 매번 직접 실행해주기는 매우 귀찮은 일입니다. 이러한 부분을 자동화하기 위해서 과거에는 Autotest 같은 툴이 사용되었습니다. Autotest는 특정 파일이 수정되면 테스트를 자동으로 실행하는 방식으로 작동합니다. 현재는 Autotest 대신에 Guard를 많이 사용하는데, Guard는 특정한 파일을 감시하다가 이러한 파일에 변화가 있을 때 특정한 명령어를 수행하는 좀 더 범용적인 툴이라고 생각하면 됩니다. 여기서는 Guard를 사용해 rspec 테스트를 자동화하는 법을 소개합니다.' name='description'>
<link href='https://plus.google.com/+KimDaekwon' rel='author'>
<link href='https://plus.google.com/+KimDaekwon' rel='publisher'>
<meta content='summary' name='twitter:card'>
<meta content='article' property='og:type'>
<meta content='nacyot의 프로그래밍 이야기 :: Rspec과 Guard를 활용한 루비 테스트 자동화' name='twitter:title'>
<meta content='nacyot의 프로그래밍 이야기 :: Rspec과 Guard를 활용한 루비 테스트 자동화' property='og:title'>
<meta content='루비 테스트로는 minitest와 Rspec이 많이 사용됩니다. 저는 대부분 Rspec을 사용합니다만, 어느 쪽이건 이러한 테스트를 매번 직접 실행해주기는 매우 귀찮은 일입니다. 이러한 부분을 자동화하기 위해서 과거에는 Autotest 같은 툴이 사용되었습니다. Autotest는 특정 파일이 수정되면 테스트를 자동으로 실행하는 방식으로 작동합니다. 현재는 Autotest 대신에 Guard를 많이 사용하는데, Guard는 특정한 파일을 감시하다가 이러한 파일에 변화가 있을 때 특정한 명령어를 수행하는 좀 더 범용적인 툴이라고 생각하면 됩니다. 여기서는 Guard를 사용해 rspec 테스트를 자동화하는 법을 소개합니다.' name='twitter:description'>
<meta content='루비 테스트로는 minitest와 Rspec이 많이 사용됩니다. 저는 대부분 Rspec을 사용합니다만, 어느 쪽이건 이러한 테스트를 매번 직접 실행해주기는 매우 귀찮은 일입니다. 이러한 부분을 자동화하기 위해서 과거에는 Autotest 같은 툴이 사용되었습니다. Autotest는 특정 파일이 수정되면 테스트를 자동으로 실행하는 방식으로 작동합니다. 현재는 Autotest 대신에 Guard를 많이 사용하는데, Guard는 특정한 파일을 감시하다가 이러한 파일에 변화가 있을 때 특정한 명령어를 수행하는 좀 더 범용적인 툴이라고 생각하면 됩니다. 여기서는 Guard를 사용해 rspec 테스트를 자동화하는 법을 소개합니다.' property='og:description'>
<meta content='@nacyo_t' name='twitter:site'>
<meta content='nacyot의 프로그래밍 이야기' property='og:site_name'>
<meta content='http://blog.nacyot.com/articles/2013-10-02-ruby-test-automation-with-rspec-and-guard/' name='twitter:url'>
<meta content='http://blog.nacyot.com/articles/2013-10-02-ruby-test-automation-with-rspec-and-guard/' property='og:url'>
<meta content='http://blog.nacyot.com/images/nacyot.jpeg' name='twitter:image'>
<meta content='http://blog.nacyot.com/images/nacyot.jpeg' property='og:image'>
<meta content='테스트, rspec, minitest, guard, autotest, ruby, 루비' name='keywords'>
<title>nacyot의 프로그래밍 이야기 :: Rspec과 Guard를 활용한 루비 테스트 자동화</title>
<link href="../../stylesheets/all.css" media="all" rel="stylesheet" type="text/css" />
<script src="../../javascripts/all.js" type="text/javascript"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-46785477-2', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>
<nav class='navbar navbar-fixed-top' role='navigation'>
<div class='navbar-header'>
<a class='navbar-brand' href='http://nacyot.com'>nacyot</a>
</div>
<div class='collapse navbar-collapse'>
<ul class='nav navbar-nav'>
<li>
<a href='http://blog.nacyot.com'>
<i class='fa fa-comment'></i>
프로그래밍 이야기
</a>
</li>
<li>
<a href='http://wiki.nacyot.com'>
<i class='fa fa-comment'></i>
nacyot wiki
</a>
</li>
</ul>
<ul class='nav navbar-nav navbar-right profile'>
<form class="navbar-form navbar-right" role="search" id="cse-search-box" action="http://google.com/cse">
<input type="hidden" name="cx" value="001442510316556568987:j38kphmalos" />
<input type="hidden" name="ie" value="UTF-8" />
<div class="form-group">
<input class="form-control" type="text" name="q" size="15" />
</div>
<button class="btn btn-default" type="submit" name="sa" value="Search">Search</button>
</form>
<li>
<a href='https://twitter.com/nacyo_t'>
<i class='fa fa-twitter twitter'></i>
@nacyo_t
</a>
</li>
<li>
<a href='https://github.com/nacyot/blog.nacyot.com-source'>
<i class='fa fa-github github'></i>
nacyot
</a>
</li>
</ul>
</div>
</nav>


<div class='mini-wall'>
<div class='profile'>
<a href="/"><img class='img-rounded profile_image' src='/images/nacyot.jpeg'>
</a>
</div>
</div>
<div class='row'>
<div class='col-lg-2 col-md-1 col-sm-1 col-xs-1'></div>
<div class='col-lg-8 col-md-10 col-sm-10 col-xs-10'>
<div class='main'>
<div class='articles'>
<div class='article'>
<div>
<span class='date'>
<i class='fa fa-calendar'></i>
Oct  2 2013
</span>
</div>
<div>
<span class='tags'>
<i class='fa fa-tag'></i>
<a href='/tags/autotest'>autotest</a>
<i class='fa fa-tag'></i>
<a href='/tags/guard'>guard</a>
<i class='fa fa-tag'></i>
<a href='/tags/minitest'>minitest</a>
<i class='fa fa-tag'></i>
<a href='/tags/rspec'>rspec</a>
<i class='fa fa-tag'></i>
<a href='/tags/ruby'>ruby</a>
<i class='fa fa-tag'></i>
<a href='/tags/루비'>루비</a>
<i class='fa fa-tag'></i>
<a href='/tags/테스트'>테스트</a>
</span>
</div>
<a name='toc'></a>
<h1 class='title'>
<a href="./">Rspec과 Guard를 활용한 루비 테스트 자동화</a>
</h1>
<div class='body'>
</div>
<div class='toc'></div>
<div class='body'>
<p>루비 테스트로는 <span class='dead_link'><a href='http://wiki.nacyot.com/documents/minitest' rel='noindex,nofollow'>minitest</a></span>와 <span class='live_link'><a href='http://wiki.nacyot.com/documents/rspec'>Rspec</a></span>이 많이 사용됩니다. 저는 대부분 Rspec을 사용합니다만, 어느 쪽이건 이러한 테스트를 매번 직접 실행해주기는 매우 귀찮은 일입니다. 이러한 부분을 자동화하기 위해서 과거에는 <span class='dead_link'><a href='http://wiki.nacyot.com/documents/autotest' rel='noindex,nofollow'>Autotest</a></span> 같은 툴이 사용되었습니다. Autotest는 특정 파일이 수정되면 테스트를 자동으로 실행하는 방식으로 작동합니다. 현재는 Autotest 대신에 Guard를 많이 사용하는데, Guard는 특정한 파일을 감시하다가 이러한 파일에 변화가 있을 때 특정한 명령어를 수행하는 좀 더 범용적인 툴이라고 생각하면 됩니다. 여기서는 <span class='dead_link'><a href='http://wiki.nacyot.com/documents/guard' rel='noindex,nofollow'>Guard</a></span>를 사용해 rspec 테스트를 자동화하는 법을 소개합니다.</p>



<h2><a name='spring'>Spring</a> <span class='to_toc'><a href='#toc'><i class='fa fa-flag'></i></a></span></h2>

<p>먼저 테스트 속도 향상을 위해 Rails preloader인
<a href="https://github.com/jonleighton/spring">spring</a>을 설정해 두었습니다.
자세한 사항은 spring github 페이지를 참조하시면 됩니다. 간단한
사용법은 <span class='dead_link'><a href='http://wiki.nacyot.com/documents/spring' rel='noindex,nofollow'>spring</a></span>을 앞에 붙여주면 됩니다. 별도로 spring server 실행
명령어를 사용할 필요가 없으며, 명령어를 처음 실행할 때 자동으로
실행됩니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="cp"># spring 설정 전 테스트</span>
</span><span id="line-2"><span class="cp"># rvm 사용시 bundle exec 는 생략하셔도 됩니다.</span>
</span><span id="line-3"><span class="n">bundle</span> <span class="n">exec</span> <span class="n">rake</span> <span class="n">rspec</span>
</span><span id="line-4">
</span><span id="line-5"><span class="cp"># spring 설정 후 테스트</span>
</span><span id="line-6"><span class="n">bundle</span> <span class="n">exec</span> <span class="n">spring</span> <span class="n">rake</span> <span class="n">rspec</span>
</span></pre></div>
<p>테스트를 지속적으로 실행하게 되므로 spring을 사용하는 편이 압도적으로
속도가 빠릅니다. 문제가 있다면 가끔씩 spring 서버에 문제가 생겨서
제대로 작동을 안 하는 경우가 있는데, 그럴 경우엔</p>
<div class="highlight"><pre><span id="line-1"><span class="n">bundle</span> <span class="n">exec</span> <span class="n">spring</span> <span class="n">stop</span>
</span></pre></div>
<p>을 실항해서 spring을 종료하시고 다시 명령어를 실행시켜주시면됩니다.</p>

<h2><a name='guard'>Guard</a> <span class='to_toc'><a href='#toc'><i class='fa fa-flag'></i></a></span></h2>

<p>단순히 spec 폴더의 파일들을 테스트 하는 것은 rake면 충분합니다만,
작업과정의 변경사항에 대한 자동적인 테스트를 실행시키기 위해서는
<a href="https://github.com/guard/guard">Guard</a>가 필요합니다. Guard는 watch와
비슷한 역할을 해주는 프로그램으로 파일을 감시하다가 특정 파일이
변경되면 거기에 해당하는 스크립트를 실행시켜줍니다. 이러한 세팅은
Guardfile에 들어가 있으며 현재는 rspec(+spring)에 대해 기본설정이
적용되어 있습니다. 아래의 명령어로 초기화합니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="n">bundle</span> <span class="n">exec</span> <span class="n">guard</span> <span class="n">init</span> <span class="n">rspec</span>
</span></pre></div>
<p>guard는 spring과는 별개로 작동하고 guard에서 파일 변화를 캐치해서
테스트를 실행할 때만 내부적으로 spring을 사용합니다. spring과
연동시켜주기 위해서 아래의 설정을 Guardfile에 추가해줍니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="cp"># default</span>
</span><span id="line-2"><span class="n">guard</span> <span class="o">:</span><span class="n">rspec</span> <span class="k">do</span>
</span><span id="line-3">
</span><span id="line-4"><span class="cp"># after</span>
</span><span id="line-5"><span class="n">guard</span> <span class="o">:</span><span class="n">rspec</span><span class="p">,</span> <span class="o">:</span><span class="n">spring</span> <span class="o">=&gt;</span> <span class="nb">true</span> <span class="k">do</span>
</span></pre></div>
<p>따라서 Rails 어플리케이션의 루트에서 아래의 명령어로 실행시키시면
됩니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="n">bundle</span> <span class="n">exec</span> <span class="n">guard</span>
</span></pre></div>
<p>보통은 <span class='live_link'><a href='http://wiki.nacyot.com/documents/tmux'>tmux</a></span>나 <span class='dead_link'><a href='http://wiki.nacyot.com/documents/screen' rel='noindex,nofollow'>screen</a></span>에서 하나의 윈도우를 할당해놓고 사용하는 게
일반적입니다. 이렇게 해두면 다른 윈도우나 텍스트 에디터에서 Rails
어플리케이션 파일이나 테스트 파일을 변경하면 guard가 자동으로 캐치해서
해당하는 부분의 spec 테스트를 실행시켜줍니다. 이런 식으로 테스트
결과를 계속 확인하면서 작업할 수 있습니다. 또한 guard 프로그램 내에서
여러가지 명령어를 실행시킬 수 있으며, 명령어 없이 엔터를 눌러주면 전체
테스트를 실행시켜 줍니다. guard는 단순히 rspec 자동화를 위해 만들어 진
<span class='dead_link'><a href='http://wiki.nacyot.com/documents/gem' rel='noindex,nofollow'>gem</a></span>은 아니라, <span class='dead_link'><a href='http://wiki.nacyot.com/documents/cucumber' rel='noindex,nofollow'>cucumber</a></span>나 서버 재실행 등 다른 작업을 실행시키는 데도
확장해서 사용할 수 있습니다.</p>

<p>테스트 결과에 대한 알림은 <span class='live_link'><a href='http://wiki.nacyot.com/documents/ubuntu'>Ubuntu</a></span> 같은 경우는 notification을 시스템
쪽으로 자동으로 주는 것 같고, Mac 같은 경우는 growl과 연동해서
사용하는 게 보통입니다. 다양한 notification 지원에 대해서는 Guard
github 페이지에 좀 더 자세히 나와있으니 참조하시면 될 것 같습니다.</p>

<h2><a name='rspec-setting'>Rspec setting</a> <span class='to_toc'><a href='#toc'><i class='fa fa-flag'></i></a></span></h2>

<p>rspec을 실행하는 데 기본 옵션 설정은 HOME 디렉토리의 .rspec 파일이나,
Rails 어플리케이션 루트의 .rspec 파일에 기록합니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="cp"># 테스트 결과에 색을 입혀 출력해줍니다.</span>
</span><span id="line-2"><span class="o">--</span><span class="n">colour</span>
</span><span id="line-3">
</span><span id="line-4"><span class="cp"># 테스트 실행 결과에 테스트 이름을 같이 보여줍니다. rspec을 사용하면</span>
</span><span id="line-5">  <span class="err">기본적으로</span> <span class="err">테스트를</span> <span class="p">.</span><span class="err">으로</span> <span class="err">출력하는데</span><span class="p">,</span> <span class="err">이게</span> <span class="err">불편하실</span> <span class="err">때</span> <span class="err">사용하시면</span>
</span><span id="line-6">  <span class="err">됩니다</span><span class="p">.</span>
</span><span id="line-7"><span class="o">--</span><span class="n">format</span> <span class="n">d</span>
</span></pre></div>
</div>
<div class='footer'>
<hr>
<div class='author'>
<h1>nacyot</h1>
프로그래머(29)
</div>
<div class='share'>
<h1>Share this post</h1>
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style addthis_32x32_style">
<a class="addthis_button_facebook"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_pocket"></a>
<a class="addthis_button_print"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":false};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-52ffce6f41e2b5e2"></script>
<!-- AddThis Button END -->
</div>
</div>
<hr>
<div id='disqus_thread'>
<script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'nacyot'; // required: replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
</div>
<div class='navigation'>
<div class='prevnav'>
</div>
<div class='nextnav'>
<div class='fa fa-chevron-right'></div>
다음 글:
<a href='/articles/2013-10-30-angularjs-style-guide/' rel='next'>AngularJs 스타일 가이드 번역</a>
</div>
<br style='clear:both'>
</div>
</div>
</div>
</div>
<div class='col-lg-2 col-md-1 col-sm-1 col-xs-1'></div>
</div>

<div class='row'>
<div class='col-lg-12'>
<hr>
<div class='site-footer'>
<p>
All content copyright
<a href='http://nacyot.com'>nacyot</a>
© 2014 • All rights reserved.
&nbsp;&nbsp;&nbsp;
<a class='icon' href='http://nacyot.com'>
<i class='fa-home fa fa-2x'></i>
</a>
<a class='icon' href='https://twitter.com/nacyo_t'>
<i class='fa-twitter fa fa-2x'></i>
</a>
<a class='icon' href='https://github.com/nacyot'>
<i class='fa-github fa fa-2x'></i>
</a>
<a class='icon' href='/feed.xml' style='color: orange'>
<i class='fa-rss fa fa-2x'></i>
</a>
</p>
</div>
</div>
</div>

</body>
</html>

<script>
  $('.toc').toc({
    'selectors': 'h2,h3,h4,h5',
    'container': '.article'
  });
</script>
