<!DOCTYPE html>
<html ng-app='devstudy'>
<head>
<!--
⣀⡀ ⢀⣀ ⢀⣀ ⡀⢀ ⢀⡀ ⣰⡀
⠇⠸ ⠣⠼ ⠣⠤ ⣑⡺ ⠣⠜ ⠘⠤

Copyright © 2013- nacyot<Daewkon Kim> All Rights Reserved.
-->
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<meta content='83PoUYOY-K48booDuuM95hVy0Mboaaw6yBbJJTzGGSk' name='google-site-verification'>
<link href='http://blog.nacyot.com/articles/2014-08-12-installing-ruby-gem-cheatsheet/' rel='canonical'>
<link href='http://blog.nacyot.com/feed.xml' rel='alternative' type='application/rss+xml'>
<link href='/articles/2014-08-08-rails-on-docker/' rel='prev' title='도커(Docker)로 루비 온 레일스 어플리케이션 배포하기 (1) 어플리케이션 이미지 만들기'>
<link href='https://plus.google.com/+KimDaekwon' rel='author'>
<link href='https://plus.google.com/+KimDaekwon' rel='publisher'>
<meta content='summary' name='twitter:card'>
<meta content='nacyot의 프로그래밍 이야기 :: 루비 젬(pg, mysql2, sqlite, curb, imagemagick, capybara)을 설치를 시스템 패키지(Site Package)' name='twitter:title'>
<meta content='' name='twitter:description'>
<meta content='@nacyo_t' name='twitter:site'>
<meta content='@nacyo_t' name='twitter:creator'>
<meta content='' name='twitter:image'>
<title>nacyot의 프로그래밍 이야기 :: 루비 젬(pg, mysql2, sqlite, curb, imagemagick, capybara)을 설치를 시스템 패키지(Site Package)</title>
<link href="../../stylesheets/all.css" media="all" rel="stylesheet" type="text/css" />
<script src="../../javascripts/all.js" type="text/javascript"></script>
</head>
<body>
<nav class='navbar navbar-fixed-top' role='navigation'>
<div class='navbar-header'>
<a class='navbar-brand' href='http://nacyot.com'>nacyot</a>
</div>
<div class='collapse navbar-collapse'>
<ul class='nav navbar-nav'>
<li>
<a href='http://blog.nacyot.com'>
<i class='fa fa-comment'></i>
프로그래밍 이야기
</a>
</li>
<li>
<a href='http://wiki.nacyot.com'>
<i class='fa fa-comment'></i>
nacyot wiki
</a>
</li>
</ul>
<ul class='nav navbar-nav navbar-right profile'>
<form class="navbar-form navbar-right" role="search" id="cse-search-box" action="http://google.com/cse">
<input type="hidden" name="cx" value="001442510316556568987:j38kphmalos" />
<input type="hidden" name="ie" value="UTF-8" />
<div class="form-group">
<input class="form-control" type="text" name="q" size="15" />
</div>
<button class="btn btn-default" type="submit" name="sa" value="Search">Search</button>
</form>
<li>
<a href='https://twitter.com/nacyo_t'>
<i class='fa fa-twitter twitter'></i>
@nacyo_t
</a>
</li>
<li>
<a href='https://github.com/nacyot/blog.nacyot.com-source'>
<i class='fa fa-github github'></i>
nacyot
</a>
</li>
</ul>
</div>
</nav>


<div class='mini-wall'>
<div class='profile'>
<a href="/"><img class='img-rounded profile_image' src='/images/nacyot.jpeg'>
</a>
</div>
</div>
<div class='row'>
<div class='col-lg-2 col-md-1 col-sm-1 col-xs-1'></div>
<div class='col-lg-8 col-md-10 col-sm-10 col-xs-10'>
<div class='main'>
<div class='articles'>
<div class='article'>
<div>
<span class='date'>
<i class='fa fa-calendar'></i>
Aug 12 2014
</span>
</div>
<div>
<span class='tags'>
</span>
</div>
<a name='toc'></a>
<h1 class='title'>
<a href="./">루비 젬(pg, mysql2, sqlite, curb, imagemagick, capybara)을 설치를 시스템 패키지(Site Package)</a>
</h1>
<div class='toc'>
<ul>
<li>
<a href="#rbenv(루비-빌드)">rbenv(루비 빌드)</a>
</li>
<li>
<a href="#sqlite3">sqlite3</a>
</li>
<li>
<a href="#mysql2">mysql2</a>
</li>
<li>
<a href="#pg">pg</a>
</li>
<li>
<a href="#nokogiri">Nokogiri</a>
</li>
<li>
<a href="#nodejs(javascript-runtime)">Nodejs(Javascript Runtime)</a>
</li>
<li>
<a href="#curb">curb</a>
</li>
<li>
<a href="#imagemagick">imagemagick</a>
</li>
<li>
<a href="#capybara-webkit">capybara-webkit</a>
</li>
</ul>

</div>
<div class='body'>
<p>여느 프로그래밍 언어와 마찬가지로 루비를 사용하면서도 정말 빠지기 쉽고, 빠질 수밖에 없는 함정이 Gem을 통한 라이브러리 설치 과정에서 생기는 문제입니다. 대부분은 패키지 설치 과정의 빌드 과정에서 일어나는 문제입니다. 에러 메시지를 좀 더 자세히 보고, 시스템 환경을 다시 갖추는 등, 좀 더 섬세한 문제 해결도 가능합니다만, 대부분은 <code>apt-get</code>(혹은 <code>brew</code> 명령어)를 통해 해당 Gem(라이브러리)이 의존성을 가진 시스템 패키지(Site Package라고도 합니다)를 설치하는 것만으로도 해결이 가능합니다. 이 글에서는 반드시 한 번은 이런 문제로 고생을 시키는 젬들을 설치하는 법을 다룹니다.</p>

<h2><a name='rbenv(루비-빌드)'>rbenv(루비 빌드)</a> <span class='to_toc'><a href='#toc'><i class='fa fa-flag'></i></a></span></h2>

<p>Gem을 다루기에 앞서 루비 빌드에 필요한 패키지들을 정리해봅니다. 여기서는 최근에 많이 사용되는 조합인 rbenv + ruby-build 플러그인을 사용해 루비를 빌드해봅니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>git clone https://github.com/sstephenson/rbenv.git ~/.rbenv
</span><span id="line-2"><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;export PATH=&quot;$HOME/.rbenv/bin:$PATH&quot;&#39;</span> &gt;&gt; ~/.bash_profile
</span><span id="line-3"><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;eval &quot;$(rbenv init -)&quot;&#39;</span> &gt;&gt; ~/.bash_profile
</span><span id="line-4"><span class="nv">$ </span>bash
</span><span id="line-5"><span class="nv">$ </span>git clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
</span><span id="line-6"><span class="nv">$ </span>rbenv install 2.1.2
</span><span id="line-7">Downloading ruby-2.1.2.tar.gz...
</span><span id="line-8">-&gt; http://dqw8nmjcqpjn7.cloudfront.net/f22a6447811a81f3c808d1c2a5ce3b5f5f0955c68c9a749182feb425589e6635
</span><span id="line-9">Installing ruby-2.1.2...
</span><span id="line-10">
</span><span id="line-11">BUILD FAILED
</span><span id="line-12">
</span><span id="line-13">Inspect or clean up the working tree at /tmp/ruby-build.20140811151005.17457
</span><span id="line-14">Results logged to /tmp/ruby-build.20140811151005.17457.log
</span></pre></div>
<p>실패합니다. 루비를 빌드하기 위해서는 빌드 툴들과 libreadline, libssl 등의 라이브러리가 시스템에 설치되어 있어야합니다. 아래 명령어로 패키지들을 설치하고 다시 빌드해봅니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>apt-get install -y build-essential autoconf libpq-dev zlib1g-dev libssl-dev libreadline-dev
</span><span id="line-2"><span class="nv">$ </span>rbenv install 2.1.2
</span></pre></div>
<p>루비가 정상적으로 설치되었는 지 확인해봅니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>rbenv global 2.1.2
</span><span id="line-2"><span class="nv">$ </span>ruby --version
</span></pre></div>
<h2><a name='sqlite3'>sqlite3</a> <span class='to_toc'><a href='#toc'><i class='fa fa-flag'></i></a></span></h2>

<p>가벼워서 로컬에서 자주 사용되는 파일 기반 데이터 sqlite3 데이터베이스 인터페이스 라이브러리입니다. 특히 레일스 개발환경의 기본 데이터베이스로 자주 사용하게 됩니다.</p>

<p>보통 rails 프로젝트를 초기화하고 <code>bundle install</code>하거나 직접 sqlite3를 설치하려고 할 때 아래와 같이 실패하곤 합니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>gem install sqlite3
</span><span id="line-2">Fetching: sqlite3-1.3.9.gem <span class="o">(</span>100%<span class="o">)</span>
</span><span id="line-3">Building native extensions.  This could take a <span class="k">while</span>...
</span><span id="line-4">ERROR:  Error installing sqlite3:
</span><span id="line-5">ERROR: Failed to build gem native extension.
</span></pre></div>
<p>이 때는 libsqlite3-dev를 설치해줍니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>sudo apt-get install libsqlite3-dev
</span><span id="line-2">Building native extensions.  This could take a <span class="k">while</span>...
</span><span id="line-3">Successfully installed sqlite3-1.3.9
</span><span id="line-4">...
</span></pre></div>
<h2><a name='mysql2'>mysql2</a> <span class='to_toc'><a href='#toc'><i class='fa fa-flag'></i></a></span></h2>

<p>다음은 아마 데이터베이스 인터페이스로 가장 많이 사용될 mysql2 라이브러리입니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>gem install mysql2
</span><span id="line-2">gem install mysql2
</span><span id="line-3">Fetching: mysql2-0.3.16.gem <span class="o">(</span>100%<span class="o">)</span>
</span><span id="line-4">Building native extensions.  This could take a <span class="k">while</span>...
</span><span id="line-5">ERROR:  Error installing mysql2:
</span><span id="line-6">ERROR: Failed to build gem native extension.
</span><span id="line-7">...
</span></pre></div>
<p>sqlite3와 비슷한 문제가 발생하는 것을 알 수 있습니다. 이 문제를 해결하기 위해서는 <code>libmysqlclient-dev</code> 패키지가 필요합니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>sudo apt-get install libmysqlclient-dev
</span><span id="line-2"><span class="nv">$ </span>gem install mysql2
</span><span id="line-3">Building native extensions.  This could take a <span class="k">while</span>...
</span><span id="line-4">Successfully installed mysql2-0.3.16
</span><span id="line-5">...
</span></pre></div>
<p>이제 정상적으로 설치되는 것을 알 수 있습니다.</p>

<p>다른 플랫폼에서는 아래 패키지를 시도해보시기 바랍니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="cp"># centos</span>
</span><span id="line-2"><span class="err">$</span> <span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">gcc</span> <span class="n">mysql</span><span class="o">-</span><span class="n">devel</span>
</span></pre></div>
<h2><a name='pg'>pg</a> <span class='to_toc'><a href='#toc'><i class='fa fa-flag'></i></a></span></h2>

<p>다음은 mysql의 대체 데이터베이스로 자주 사용되는 postgresql의 루비 인터페이스 라이브러리인 pg입니다. pg를 설치하려고 시도하면, 아래와 같은 에러를 만나게 되는 경우가 있습니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>gem install pg
</span><span id="line-2">Fetching: pg-0.17.1.gem <span class="o">(</span>100%<span class="o">)</span>
</span><span id="line-3">Building native extensions.  This could take a <span class="k">while</span>...
</span><span id="line-4">ERROR:  Error installing pg:
</span><span id="line-5">ERROR: Failed to build gem native extension.
</span><span id="line-6">...
</span></pre></div>
<p>이 때는 libpq-dev 패키지를 설치해줍니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>sudo apt-get install libpq-dev
</span><span id="line-2"><span class="nv">$ </span>gem install pg
</span><span id="line-3">Building native extensions.  This could take a <span class="k">while</span>...
</span><span id="line-4">Successfully installed pg-0.17.1
</span><span id="line-5">...
</span></pre></div>
<h2><a name='nokogiri'>Nokogiri</a> <span class='to_toc'><a href='#toc'><i class='fa fa-flag'></i></a></span></h2>

<p>루비를 사용하다보면 여기저기서 만나게 되는 라이브러리 중의 하나가 Nokogiri 입니다. Nokogiri 역시 설치가 실패하는 경우가 많습니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>gem install nokogiri
</span><span id="line-2">Fetching: mini_portile-0.6.0.gem <span class="o">(</span>100%<span class="o">)</span>
</span><span id="line-3">Successfully installed mini_portile-0.6.0
</span><span id="line-4">Fetching: nokogiri-1.6.3.1.gem <span class="o">(</span>100%<span class="o">)</span>
</span><span id="line-5">...
</span><span id="line-6">Done installing documentation <span class="k">for </span>mini_portile, nokogiri after 2 seconds
</span><span id="line-7">2 gems installed
</span></pre></div>
<p>음... 문제 없이 설치가 되네요. 설치 과정을 좀 더 자세히보면 아래와 같이 나오는 것을 알 수 있습니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="n">IMPORTANT</span><span class="o">!</span>  <span class="n">Nokogiri</span> <span class="n">builds</span> <span class="n">and</span> <span class="n">uses</span> <span class="n">a</span> <span class="n">packaged</span> <span class="n">version</span> <span class="n">of</span> <span class="n">libxml2</span><span class="p">.</span>
</span><span id="line-2"><span class="p">...</span>
</span><span id="line-3"><span class="n">For</span> <span class="n">example</span><span class="p">,</span> <span class="n">libxml2</span><span class="o">-</span><span class="mf">2.9.0</span> <span class="n">and</span> <span class="n">higher</span> <span class="n">are</span> <span class="n">currently</span> <span class="n">known</span> <span class="n">to</span> <span class="n">be</span> <span class="n">broken</span>
</span><span id="line-4"><span class="n">and</span> <span class="n">thus</span> <span class="n">unsupported</span> <span class="n">by</span> <span class="n">nokogiri</span><span class="p">,</span> <span class="n">due</span> <span class="n">to</span> <span class="n">compatibility</span> <span class="n">problems</span> <span class="n">and</span>
</span><span id="line-5"><span class="n">XPath</span> <span class="n">optimization</span> <span class="n">bugs</span><span class="p">.</span>
</span><span id="line-6"><span class="p">...</span>
</span><span id="line-7"><span class="n">IMPORTANT</span><span class="o">!</span>  <span class="n">Nokogiri</span> <span class="n">builds</span> <span class="n">and</span> <span class="n">uses</span> <span class="n">a</span> <span class="n">packaged</span> <span class="n">version</span> <span class="n">of</span> <span class="n">libxslt</span><span class="p">.</span>
</span><span id="line-8"><span class="p">...</span>
</span><span id="line-9"><span class="n">gem</span> <span class="n">install</span> <span class="n">nokogiri</span> <span class="o">--</span> <span class="o">--</span><span class="n">use</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">libraries</span>
</span></pre></div>
<p>호환성 문제 및 설치 문제를 해결하기 위해 libxml2와 libxslt를 아예 내장한 것으로 보입니다.</p>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>sudo apt-get install libxslt-dev libxml2-dev
</span></pre></div>
<p>문제없이 설치되는 것을 알 수 있습니다.</p>

<h2><a name='nodejs(javascript-runtime)'>Nodejs(Javascript Runtime)</a> <span class='to_toc'><a href='#toc'><i class='fa fa-flag'></i></a></span></h2>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>sudo apt-get install nodejs
</span></pre></div>
<h2><a name='curb'>curb</a> <span class='to_toc'><a href='#toc'><i class='fa fa-flag'></i></a></span></h2>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>sudo apt-get install libcurl4-openssl-dev libcurl4-gnutls-dev
</span></pre></div>
<h2><a name='imagemagick'>imagemagick</a> <span class='to_toc'><a href='#toc'><i class='fa fa-flag'></i></a></span></h2>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>sudo apt-get install libmagickwand-dev
</span></pre></div><div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>yum install ImageMagick-devel
</span></pre></div><div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>brew install imagemagick
</span></pre></div>
<h2><a name='capybara-webkit'>capybara-webkit</a> <span class='to_toc'><a href='#toc'><i class='fa fa-flag'></i></a></span></h2>
<div class="highlight"><pre><span id="line-1"><span class="nv">$ </span>sudo apt-get install libqt4-dev libqtwebkit-dev
</span></pre></div>
</div>
<div class='footer'>
<hr>
<div class='author'>
<h1>nacyot</h1>
프로그래머(29)
</div>
<div class='share'>
<h1>Share this post</h1>
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style addthis_32x32_style">
<a class="addthis_button_facebook"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_pocket"></a>
<a class="addthis_button_print"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":false};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-52ffce6f41e2b5e2"></script>
<!-- AddThis Button END -->
</div>
</div>
<hr>
<div id='disqus_thread'>
<script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'nacyot'; // required: replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
</div>
<div class='navigation'>
<div class='prevnav'>
<div class='fa fa-chevron-left'></div>
이전 글
<a href='/articles/2014-08-08-rails-on-docker/' rel='prev'>도커(Docker)로 루비 온 레일스 어플리케이션 배포하기 (1) 어플리케이션 이미지 만들기</a>
</div>
<div class='nextnav'>
</div>
<br style='clear:both'>
</div>
</div>
</div>
</div>
<div class='col-lg-2 col-md-1 col-sm-1 col-xs-1'></div>
</div>

<div class='row'>
<div class='col-lg-12'>
<hr>
<div class='site-footer'>
<p>
All content copyright
<a href='http://nacyot.com'>nacyot</a>
© 2014 • All rights reserved.
&nbsp;&nbsp;&nbsp;
<a class='icon' href='http://nacyot.com'>
<i class='fa-home fa fa-2x'></i>
</a>
<a class='icon' href='https://twitter.com/nacyo_t'>
<i class='fa-twitter fa fa-2x'></i>
</a>
<a class='icon' href='https://github.com/nacyot'>
<i class='fa-github fa fa-2x'></i>
</a>
<a class='icon' href='/feed.xml' style='color: orange'>
<i class='fa-rss fa fa-2x'></i>
</a>
</p>
</div>
</div>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-46785477-2', 'nacyot.com');
  ga('send', 'pageview');
</script>
</body>
</html>

